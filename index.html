<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>CTRpixAI</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<link rel="icon" href="logo.png" type="image/png">
<style>

.dropbtn {
  background-color: #6B8E23;
}

.dropdown {
  border-radius: 8px;
  top: 0px;
  left: 0px;
}

.dropdown-content {
border-radius: 8px;
  /* display: none; */ 
  opacity: 0; /* here */
  min-width: 160px;
  z-index: 1;
background-color: #ffff99;
  transition: all 0.3s ease; /* here */
  height: 0px;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.dropdown-content a:hover {
  cursor: auto;
background-color: #eeee99;
border-radius: 8px;
}

.dropdown:hover .dropdown-content {
/*   display: block; */ /* no need for display block and none, you can depend on opacity as long as the position is absolute*/
  opacity: 1; /* here */
height: 214px;
}

.dropdown:hover .dropbtn {
  cursor: auto;
  background-color: #495d29;
}
</style>

    <style>@font-face{
	font-family: "Bold";
	src:url("Poppins-Bold.ttf");
}
        body, html {
            margin: 0;
            padding: 0;
            height: auto;
            width: 100%;
            overflow-x: hidden;
            overflow-y: auto;
font-family: "Bold";
        }

        body {
                            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f4;
            font-family: "Bold";
text-align: center;
        }
input[type="range"] {
  -webkit-appearance: none;
  width: 100%;
  height: 5px;
  border-radius: 9px;  
  background: #ccc;
  outline: none;
  opacity: 1;
  -webkit-transition: .2s;
  transition: opacity .2s;
padding: 0px;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 25px;
  height: 25px;
  border-radius: 50%; 
  background: green;
  cursor: pointer;
padding: 0px;
}

input[type="range"]::-moz-range-thumb {
  width: 25px;
  height: 25px;
  border-radius: 50%;
  background: green;
  cursor: pointer;
padding: 0px;
}
.sidenavx {
display: initial;
  height: 100%; /* 100% Full-height */
  width: 100%; /* 0 width - change this with JavaScript */
  position: fixed; /* Stay in place */
  z-index: 9998; /* Stay on top */
  top: 0; /* Stay at the top */
  left: 0;
  background-color: rgba(0, 0, 0, 0); /* Black*/
  overflow-x: hidden; /* Disable horizontal scroll */
  padding-top: 60px; /* Place content 60px from the top */
text-align: left;
flex-direction: column;
pointer-events: none;
            align-items: left;
  transition: 1s; /* 0.5 second transition effect to slide in the sidenav */
}
/* The side navigation menu */
.sidenav {
  height: 100%; /* 100% Full-height */
  width: 0; /* 0 width - change this with JavaScript */
  position: fixed; /* Stay in place */
  z-index: 9999; /* Stay on top */
  top: 0; /* Stay at the top */
  left: 0;
  background-color: #fff; /* Black*/
  overflow-x: hidden; /* Disable horizontal scroll */
  padding-top: 60px; /* Place content 60px from the top */
text-align: left;
flex-direction: column;
            align-items: left;
  transition: 0.5s; /* 0.5 second transition effect to slide in the sidenav */
}

.sidenav a{
padding-bottom: 20px;
padding-left: 30px;
  text-decoration: none;
  font-size: 20px;
  color: #777;
  display: block;
  transition: 0.3s;
white-space: nowrap;
}

/* When you mouse over the navigation links, change their color */
.sidenav a:hover {
  color: #000000;
}

/* Position and style the close button (top right corner) */
.sidenav .closebtn {
  position: absolute;
  top: 9px;
  right: 25px;
  font-size: 36px;
  margin-left: 50px;
}

/* Style page content - use this if you want to push the page content to the right when you open the side navigation */
#main {
  transition: margin-left .5s;
  padding: 20px;
}

/* On smaller screens, where height is less than 450px, change the style of the sidenav (less padding and a smaller font size) */
@media screen and (max-height: 450px) {
  .sidenav {padding-top: 15px;}
  .sidenav a {font-size: 18px;}
}

        .container {
            text-align: center;
   font-family: "Bold";
        }

        #editorCanvas {
            background-color: #000;
            width: 90%;
            height: auto;
   font-family: "Bold";
border-radius: 8px;
margin: auto;
        }

        input[type="file"], input[type="text"], input[type="color"], input[type="range"], input[type="number"] {
            margin-top: 10px;
            padding: 10px;
   font-family: "Bold";
border-radius: 8px;
border: none;
text-decoration: none !important;
outline: none;
        }
input {
  text-decoration: none; /* Removes underline */
  border: none;          /* Removes border if present */
  outline: none;         /* Removes focus outline */
}

.settings input[type="text"], input[type="number"]{
margin-top: 0px;
}
.file-label {
            padding: 10px 20px;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
   font-family: "Bold";
background-color: cyan;
border-radius: 8px;
}
.file-label:hover{
background-color: darkcyan;}
input[type="file"]{
            display: none;
        }
input[type="number"] {
      -moz-appearance: textfield; /* Firefox */
      -webkit-appearance: none; /* Safari and Chrome */
      appearance: none; /* Standard property */
    }

    /* Optional: Prevent margin gaps */
    input[type="number"]::-webkit-inner-spin-button, 
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
        .image-list {
            display: flex;
            flex-direction: row;
            overflow-x: auto;
            max-height: 130px;
height: 130px;
            padding: 10px;
            width: 90%;
            margin-right: 10px;
   font-family: "Bold";
overflow-y: hidden;
margin-bottom: 0px;
transition: 1s;
        }
button, a, .file-label{
user-select: none;
box-shadow: 0 0 0px rgba(0, 123, 255, 0); /* Custom focus indication */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
transition: 0.5s;
    }

        .image-list div {
    position: relative;
    text-align: center;
    font-size: 12px;
margin-right: 10px;
    margin-top: 5px;
    display: flex; /* Enables flexbox */
flex-direction: column; /* Stacks buttons vertically */
    align-items: center; /* Centers buttons horizontally */
    font-family: "Bold";
}

        .image-list img, .image-list canvas {
            width: 100px;
            height: 100px;
            object-fit: contain;
            margin-right: 10px;
            cursor: pointer;
            position: relative;
            z-index: 1;
            background-color: #000;
border-radius:8px;
   font-family: "Bold";
box-shadow: 0 0 0px rgba(0, 123, 255, 0); /* Custom focus indication */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        .coordinate-inputs {
            margin-top: 10px;
            display: none;
            text-align: center;
   font-family: "Bold";
        }

        .coordinate-inputs label, .coordinate-inputs input {
            margin: 5px;
            padding: 5px;
   font-family: "Bold";
        }

        .clear-all-btn, .add-text-btn, .export-btn, .done-btn, .bg-btn, .share-btn{
            margin: 10px;
            padding: 10px 20px;
            color: white;
            border: none;
            font-size: 16px;
border-radius: 8px;
            cursor: pointer;
   font-family: "Bold";
        }
        .clear-all-btn { background-color: red;    font-family: "Bold";}
        .clear-all-btn:hover { background-color: darkred; }

.done-btn { background-color: green;    font-family: "Bold";}
        .done-btn:hover { background-color: darkgreen; }

        .add-text-btn { background-color: orange;    font-family: "Bold";}
        .add-text-btn:hover { background-color: darkorange; }

        .export-btn { background-color: blue;   font-family: "Bold";}
        .export-btn:hover { background-color: darkblue; }
.share-btn { background-color: orange;   font-family: "Bold";}
        .share-btn:hover { background-color: darkorange; }

        .delete-btn {
            cursor: pointer;
            color: white;
            background-color: red;
            padding: 5px 10px;
            margin-top: 5px;
            text-align: center;
            font-size: 14px;
            border: none;
border-radius: 8px;
margin-right: 10px;
   font-family: "Bold";
width: 80px;
        }
.moveup-btn {
            cursor: pointer;
            color: white;
            background-color: gray;
            padding: 5px 10px;
            margin-top: 0px;
            text-align: center;
            font-size: 14px;
            border: none;
border-radius: 5px;
   font-family: "Bold";
width: 80px;
        }
.movedown-btn {
            cursor: pointer;
            color: white;
            background-color: magenta;
            padding: 5px 10px;
            margin-top: 0px;
            text-align: center;
            font-size: 14px;
            border: none;
border-radius: 5px;
   font-family: "Bold";
width: 80px;
        }
.txtHex{
display: none;
   font-family: "Bold";
}
.txtValue {
    display: none;
   font-family: "Bold";
}
footer{
            text-align: center;
            background: #fff;
            color: #000;
            padding: 1rem 0;
            margin-top: 3rem;
width: 100%;
}
.logo{
margin-bottom: 3rem;
}
.logo .profile-picture {
width: 30px;
height: 30px;
      color: white;
background-color: #888;
      font-size: 20px; /* Adjust font size */
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%; /* Makes it circular */
      text-transform: uppercase; /* Ensures letter is uppercase */
    }
h1{
color: #000;
}
.checked{
color: #ffd000;
.nochecked{
color: #000000;
}
.rating-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stars {
            display: inline-flex;
            align-items: center;
        }
        .delete-btn:hover { background-color: darkred; }
 .moveup-btn:hover { background-color: darkgray;}
.movedown-btn:hover { background-color: purple; }
</style>
</head>
<body>
<div id="mySidenavx" class="sidenavx"></div>
<div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()" style="font-family: Arial !important;
    font-size: Arial !important;">&times;</a>
  <a href="javascript:void(0)">A/B test</a>
  <a href="javascript:void(0)">Pricing</a>
  <a href="javascript:void(0)">Affiliate program</a>
  <a href="javascript:void(0)">Feedback</a>
<a href="javascript:void(0)">Privacy policy</a>
<a href="javascript:void(0)">About us</a>
</div>

<div class="logo"><span style="display: flex; align-items: center; justify-content: center; gap: 6px;"><h1 onclick="openNav()" style="color: #ff0000;">&#9776&nbspCTRpixAI</h1><div class="profile-picture">A</div>
</span><h3 style="color: #888;">Boost your views by <span style="color: #00cc00;">50%</span></h3><div style="left: 0; width: 100%; position: relative; padding-bottom: 55%;"><iframe src="https://www.youtube.com/embed/kfIsp4l0OaY?rel=0" style="font-family: initial !important;
    font-size: initial !important; top: 0; left: 0; border-radius: 8px; width: 100%; height: 100%; position: absolute; border: none;" allowfullscreen scrolling="no" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share;"></iframe></div></div>
    <div class="container"><div style="margin-bottom: 16px;">
<label for="imageUpload" class="file-label">Upload Image</label>
        <input type="file" id="imageUpload" accept="image/*"></div><br>

        <input type="text" id="textInput" placeholder="Enter text...">
        <button class="add-text-btn" id="addTextBtn">Add Text</button>
<div id="layerCounter" style="margin-bottom: 10px; font-size: 18px; font-family: 'Bold';">
    Layers: 0
</div><div style="display: none;">
<textarea id="inpa">{
"visits": 0
}</textarea>
<textarea id="inpu">{
"visits": 0
}</textarea>
<textarea id="inpt">{
"visits": 0
}</textarea></div>
        <canvas id="editorCanvas" width="1920" height="1080"></canvas>
    </div>
    
    <div class="image-list" id="imageList"></div>

    <div class="coordinate-inputs" id="coordinateInputs">
        <label for="xPos">X: </label><input type="range" id="xPos" min="-25" max="125" value="50" step="0.1">
        <label for="yPos">Y: </label><input type="range" id="yPos" min="-25" max="125" value="50" step="0.1">
<label for="tiltPos" id="tiltLabel">Tilt: </label><input type="range" id="tiltPos" min="-10" max="10" value="0.0" step="1"><label for="scale">Scale: </label><input type="range" id="scale" min="1" max="1000" value="100" step="0.1">
        <label for="rotation">Rotation: </label><input type="range" id="rotation" min="-180" max="180" value="0" step="7.5">
        <label for="opacity">Opacity: </label><input type="range" class="slider" id="opacity" min="0" max="100" step="0.1" value="100">
<label id="txtHexLabel" for="txtHex">Color: </label><input type="text" id="txtHex" placeholder="#ff0000" maxlength="7">
<label id="txtValueLabel" for="txtValue">Edit Text: </label>
<input type="text" id="txtValue" placeholder="Change text" maxlength="100">

    <button class="done-btn" id="doneBtn">Done</button>
<!-- Add the Remove Background button next to the Done button -->
<button class="done-btn" id="removeBgBtn">Remove Bg</button>

    </div>

        <div class="settings" style="display: inline-flex;"><p style="margin-right: 15px;">size:</p><input type="number" style="width: 50px; margin-right: 5px;" id="widthInput" placeholder="1920"><p>×</p>
<input type="number" style="width: 50px; margin-left: 5px;" id="heightInput" placeholder="1080"><p>px</p></div>
<div class="settings" style="margin-top: 10px; display: inline-flex;"><p style="margin-right: 15px;"><p>name:</p>
<input type="text" style="width: 80px; margin-left: 5px;" id="nameInput" placeholder="thumbnail"></div>
   
    <button class="clear-all-btn" id="clearAllBtn">Clear All</button>
    <button class="export-btn" id="exportBtn" onclick="exportAndUploadCanvas()">Export Image</button><!--<div class="dropdown">
  <button title="General Information" class="export-btn">Export As</button>
  <div class="dropdown-content">
    <a href="javascript:void(0)">.png</a>
    <a href="javascript:void(0)">.jpeg</a>
    <a href="javascript:void(0)">.webp</a>
    <a href="javascript:void(0)">.gif</a>
    <a href="javascript:void(0)">.bmp</a>
    </div>-->
    </div>
<button class="share-btn" id="shareBtn">Share Image</button>
<div id="rate" style="font-size: 18px; font-family: 'Bold'; width: 90%; border-radius: 5px; background-color: #fff;">
    <h3>Rating</h3>
<p>24,692 reviews</p>
<div class="rating-container" style="padding-bottom: 10px; padding-top: 10px;>
    <div class="stars">
        <!-- Filled stars -->
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <!-- Empty star -->
        <span class="fa fa-star nochecked"></span>
<span><p style="display: none;" id="output">4.2/5.0 stars</p><p>4.5/5.0 stars</p></span>
    </div>
</div>
</div>
<footer>&copy; 2024 CTRpixAI. All rights reserved.
</footer>

<script>
        const canvas = document.getElementById("editorCanvas");
        const ctx = canvas.getContext("2d");
        const imageUpload = document.getElementById("imageUpload");
        const textInput = document.getElementById("textInput");
        const opacitySlider = document.getElementById("opacity");
        const addTextBtn = document.getElementById("addTextBtn");
        const imageListContainer = document.getElementById("imageList");
        const xPosInput = document.getElementById("xPos");
        const yPosInput = document.getElementById("yPos");
        const scaleInput = document.getElementById("scale");
        const rotationInput = document.getElementById("rotation");
const angleInput = document.getElementById("tiltPos");
        const clearAllBtn = document.getElementById("clearAllBtn");
        const exportBtn = document.getElementById("exportBtn");
const shareBtn = document.getElementById("shareBtn");
        const hexInput = document.getElementById("txtHex");
const txtHexLabel = document.getElementById("txtHexLabel");
  const widthInput = document.getElementById("widthInput");
const heightInput= document.getElementById("heightInput");
 const doneBtn = document.getElementById("doneBtn");
const layerCounter = document.getElementById("layerCounter");
const nameInput = document.getElementById("nameInput");

function updateLayerCounter() {
    layerCounter.textContent = `Layers: ${elements.length}`;
}
        let elements = [];
        let selectedElementIndex = null;
canvas.width = 1920;
canvas.height = 1080;
        imageUpload.addEventListener("change", handleImageUpload);
        addTextBtn.addEventListener("click", handleAddText);
        xPosInput.addEventListener("input", updateElementPosition);
        yPosInput.addEventListener("input", updateElementPosition);
        scaleInput.addEventListener("input", updateElementScale);
angleInput.addEventListener("input", updateElementAngle);
        rotationInput.addEventListener("input", updateElementRotation);
        opacitySlider.addEventListener("input", updateElementOpacity);
        clearAllBtn.addEventListener("click", clearAllElements);
        exportBtn.addEventListener("click", exportCanvas);
shareBtn.addEventListener("click", shareCanvasImage);
heightInput.addEventListener("input", resizeCanvas);
hexInput.addEventListener("input", updateElementColor);
doneBtn.addEventListener("click", closeEditor);
widthInput.addEventListener("input", resizeCanvas);
nameInput.addEventListener("input", renameCanvas);
const txtValueInput = document.getElementById("txtValue");
const txtValueLabel = document.getElementById("txtValueLabel");
const angleInputLabel = document.getElementById("tiltLabel");
txtValueInput.addEventListener("input", () => {
    if (selectedElementIndex === null) return;
    const element = elements[selectedElementIndex];
    if (element.type === "text") {
        element.text = txtValueInput.value;
        updateImageList(); // Update the preview
        drawCanvas(); // Redraw the canvas
    }
});

const removeBgBtn = document.getElementById("removeBgBtn");

removeBgBtn.addEventListener("click", async () => {
    if (selectedElementIndex === null) {
        alert("Please select an image first.");
        return;
    }

    const element = elements[selectedElementIndex];
    if (element.type !== "image") {
        alert("Only images can have their background removed.");
        return;
    }
removeBgBtn.textContent = "Removing...";

    try {
        const formData = new FormData();
        formData.append("image_file", await fetch(element.img.src).then(res => res.blob()));
        formData.append("size", "auto");

        const response = await fetch("https://api.remove.bg/v1.0/removebg", {
            method: "POST",
            headers: {
                "X-Api-Key": "AXscbgss6FQcXB2VJ49WhYL3",
            },
            body: formData,
        });

        if (response.ok) {
            const blob = await response.blob();
            const url = URL.createObjectURL(blob);
            const img = new Image();
            img.src = url;

            img.onload = function () {
                // Replace the image while preserving original size and position
                const originalWidth = element.img.width;
                const originalHeight = element.img.height;
                const originalX = element.x;
                const originalY = element.y;

                // Update the image object with the new background-removed image
                element.img = img;
                element.img.width = originalWidth; // Preserve original width
                element.img.height = originalHeight; // Preserve original height
                element.x = originalX; // Preserve original x position
                element.y = originalY; // Preserve original y position
                drawCanvas(); // Redraw the canvas with the updated image
                updateImageList(); // Update the image list to reflect the changes
            };
        } else {
removeBgBtn.textContent = "Failed :(";
            const error = await response.text();
            //alert(`Failed to remove background: ${error}`);
        }
    } catch (err) {
removeBgBtn.textContent = "Failed :(";
        //console.error(err);
        //alert("An error occurred while processing the image.");
    }
});

        // Handle image upload
        function handleImageUpload(event) {
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function(e) {
                const img = new Image();
                img.src = e.target.result;
                img.onload = function() {
                    elements.push({ type: "image", img, x: canvas.width / 2, y: canvas.height / 2, scale: 100, rotation: 0, opacity: 100, angle: 0});
                    updateImageList();
                    drawCanvas();
                };
            };

            reader.readAsDataURL(file);
        }

        // Handle adding text
        function handleAddText() {
            const text = textInput.value.trim();
            if (!text) return;

            elements.push({ type: "text", text, x: canvas.width / 2, y: canvas.height / 2, scale: 100, rotation: 0, color: "#ffffff", opacity: 100});
            textInput.value = "";
            updateImageList();
            drawCanvas();
        }

        // Update the image list
        function updateImageList() {
removeBgBtn.textContent = "Remove Bg";
            imageListContainer.innerHTML = '';

            elements.forEach((element, index) => {
                const container = document.createElement("div");

                if (element.type === "image") {
                    const canvas = document.createElement("canvas");
            canvas.width = 100;
            canvas.height = 100; // Ensure square canvas for image preview
            const ctx = canvas.getContext("2d");

            // Scale the image proporionally to fit within the canvas
            const scaleFactor = Math.min(canvas.width / element.img.width, canvas.height / element.img.height);
            const scaledWidth = element.img.width * scaleFactor;
            const scaledHeight = element.img.height * scaleFactor;
            const offsetX = (canvas.width - scaledWidth) / 2;
            const offsetY = (canvas.height - scaledHeight) / 2;

            ctx.drawImage(element.img, offsetX, offsetY, scaledWidth, scaledHeight);
ctx.textAlign = "left";
                    ctx.textBaseline = "top";
ctx.font = `20px Arial`;
                    ctx.fillStyle = "#fff";
                    ctx.fillText(`#${index+1}`, 6, 6);
            canvas.onclick = () => selectElement(index);
            container.appendChild(canvas);
                } else if (element.type === "text") {
                    const canvas = document.createElement("canvas");
                    canvas.width = 100;
                    canvas.height = 100;  // Ensure square canvas for text preview
                    const ctx = canvas.getContext("2d");

                    ctx.font = `${60/(element.text.length/2.1)}px Arial`;
                    ctx.fillStyle = element.color;
                    
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
//ctx.strokeStyle = "#fff";
//ctx.lineWidth = 0;
//ctx.strokeText(element.text, canvas.width / 2, canvas.height / 2);
                    ctx.fillText(element.text, canvas.width / 2, canvas.height / 2);
           
ctx.textAlign = "left";
                    ctx.textBaseline = "top";
ctx.font = `20px Arial`;
                    ctx.fillStyle = "#fff";
                    ctx.globalAlpha = 100;  // Apply opacity
                    ctx.fillText(`#${index+1}`, 6, 6);
                    canvas.onclick = () => selectElement(index);
                    container.appendChild(canvas);
                }

                deleteBtn = document.createElement("span");
                deleteBtn.textContent = "Delete";
                deleteBtn.classList.add("delete-btn");
                deleteBtn.onclick = () => deleteElement(index);
container.appendChild(deleteBtn);


                imageListContainer.appendChild(container);
            });
if(elements.length<1){
imageListContainer.style.height="0px";
imageListContainer.style.marginB,ottom="0px";
}
if(elements.length>0){
imageListContainer.style.height="130px";
imageListContainer.style.marginBottom="20px";
}

        }

        // Draw the canvas
        function drawCanvas() {
updateLayerCounter();
ctx.clearRect(0, 0, canvas.width, canvas.height);

ctx.fillStyle = "rgba(0, 0, 0, 1)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
          
            elements.forEach((element, index) => {
                ctx.save();
ctx.translate(element.x, element.y);
                ctx.rotate((element.rotation * Math.PI) / 180);
                ctx.globalAlpha = element.opacity / 100;  // Apply opacity
                if (element.type === "image") {
                    const imgWidth = element.img.width * (element.scale / 100);
                    const imgHeight = element.img.height * (element.scale / 100);
      // Calculate 3D effect value

const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
const xPos = element.x-centerX;
const yPos = element.y-centerY;
      const scaleX = Math.cos((element.angle*4)*(Math.PI/90)); // Horizontal compression based on rotation
      const skewY = Math.sin((element.angle*4)*(Math.PI/90))*0.5; // Skew for depth 
      // Apply transformations
      ctx.setTransform(
        scaleX,       // Scale X
        skewY,        // Skew Y
        0,            // Skew X
        1,            // Scale Y
        centerX+xPos,      // Translate X
        centerY+yPos    // Translate Y
      );
ctx.rotate((element.rotation * Math.PI) / 180);
                    ctx.drawImage(element.img, -imgWidth/2, -imgHeight/2, imgWidth, imgHeight);
if(selectedElementIndex == index){
  ctx.strokeStyle = "#ffffff"; // Outline color
                   ctx.lineWidth = 10;
                    ctx.strokeRect(-imgWidth/2, -imgHeight/2, imgWidth, imgHeight);
}
                    //ctx.strokeStyle = "#ffffff"; // Outline color
                   // ctx.lineWidth = 10;
                    //ctx.strokeRect(-imgWid
                      } else if (element.type === "text") {
                    ctx.font = `${element.scale}px Arial`;
                    ctx.fillStyle = element.color;
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
if(selectedElementIndex == index){
  ctx.shadowColor=element.color;
ctx.shadowBlur=60*element.scale;
ctx.lineWidth=0;
ctx.strokeText(element.text, 0, 0);
}
                    ctx.fillText(element.text, 0, 0);  // Centered text

                }

                ctx.restore();
            });
        }
function closeEditor(){
selectedElementIndex = null;
updateImageList();
           drawCanvas(); document.getElementById("coordinateInputs").style.display = "none";
      }

        // Select an element for editing
        function selectElement(index) {
    selectedElementIndex = index;
    const element = elements[index];
    document.getElementById("coordinateInputs").style.display = "inline-grid";
    xPosInput.value = (element.x / canvas.width) * 100;
    yPosInput.value = (element.y / canvas.height) * 100;
    scaleInput.value = element.scale;
    rotationInput.value = element.rotation;
    opacitySlider.value = element.opacity;
angleInput.value = element.angle;

    if (element.type === "text") {
        hexInput.style.display = "initial";
        txtValueInput.style.display = "initial";
angleInput.style.display = "none";
angleInputLabel.style.display = "none";
        txtValueLabel.style.display = "initial";
txtHexLabel.style.display = "initial";
        removeBgBtn.style.display = "none";
        hexInput.value = element.color;
        txtValueInput.value = element.text; // Show current text
    } else if (element.type === "image") {
        hexInput.style.display = "none";
angleInput.style.display = "initial";
angleInputLabel.style.display = "initial";
        txtValueInput.style.display = "none";
txtHexLabel.style.display = "none";
        txtValueLabel.style.display = "none";
        removeBgBtn.style.display = "initial";
    }
drawCanvas();
}

        // Delete an element
        function deleteElement(index) {
            elements.splice(index, 1);
            updateImageList();
closeEditor();
            drawCanvas();
        }

        // Update element position based on coordinate inputs
        function updateElementPosition() {
            if (selectedElementIndex === null) return;
            const element = elements[selectedElementIndex];
            element.x = (xPosInput.value / 100) * canvas.width;
            element.y = (yPosInput.value / 100) * canvas.height;
updateImageList();
            drawCanvas();
        }

        // Update element scale
        function updateElementScale() {
            if (selectedElementIndex === null) return;
            const element = elements[selectedElementIndex];
            element.scale = scaleInput.value;
updateImageList();
            drawCanvas();
        }
function updateElementAngle() {
            if (selectedElementIndex === null) return;
            const element = elements[selectedElementIndex];
            element.angle = angleInput.value;
updateImageList();
            drawCanvas();
        }
function updateElementColor() {
            if (selectedElementIndex === null) return;
            const element = elements[selectedElementIndex];
            if (element.type === "text") {
if(hexInput.value.length == 4 || hexInput.value.length == 7){
                element.color = hexInput.value;
}
        updateImageList();
                drawCanvas();
            }
        }

function resizeCanvas(){

if(heightInput.value > 1080){
heightInput.value = 1080;
}
if(widthInput.value > 1920){
widthInput.value = 1920;
}
if(heightInput.value.length > 0){
canvas.height = heightInput.value;
}
if(widthInput.value.length > 0){
canvas.width = widthInput.value;
}
updateImageList();
                drawCanvas();
        }
function renameCanvas(){
nameInput.value = nameInput.value.replace(/\..*/, "");
}

        // Update element rotation
        function updateElementRotation() {
            if (selectedElementIndex === null) return;
            const element = elements[selectedElementIndex];
            element.rotation = rotationInput.value;
updateImageList();
            drawCanvas();
        }

        // Update opacity when the slider is moved
        function updateElementOpacity() {
            if (selectedElementIndex === null) return;
            const element = elements[selectedElementIndex];
            element.opacity = opacitySlider.value;
updateImageList();
            drawCanvas();
        }

        // Update text color

        // Clear all elements from the canvas
        function clearAllElements() {
    const confirmDelete = confirm("Are you sure you want to delete all elements?");
    if (confirmDelete) {
        elements = [];
closeEditor();
        updateImageList();
        drawCanvas();
    }
}
async function shareCanvas(name) {
  const canvasElement = document.getElementById('editorCanvas');
  const idataUrl = canvasElement.toDataURL();
  const blob = await (await fetch(idataUrl)).blob();
  const filesArray = [
    new File(
      [blob],
      name,
      {
        type: blob.type,
        lastModified: new Date().getTime()
      }
    )
  ];
  const shareData = {
    files: filesArray,
  };
  navigator.share(shareData);
}
        // Export canvas as image
        function exportCanvas() {
closeEditor();
            const dataUrl = canvas.toDataURL("image/png");
            const link = document.createElement("a");
            link.href = dataUrl;
            link.download = `${nameInput.value}.png`;
            link.click();
}
function shareCanvasImage(){
closeEditor();
const dataUrl = canvas.toDataURL("image/png");
            const link = document.createElement("a");
            link.href = dataUrl;
            link.download = `${"CTRpixAI"}.png`;
shareCanvas(link.download);
}
updateImageList();
function openNav() {
  document.getElementById("mySidenav").style.width = "250px";
document.getElementById("mySidenavx").style.backgroundColor = "rgba(0, 0, 0, 0.7)";
disableScroll();
}
function closeNav() {
  document.getElementById("mySidenav").style.width = "0";
document.getElementById("mySidenavx").style.backgroundColor = "rgba(0, 0, 0, 0)";
enableScroll();
}

var keys = {37: 1, 38: 1, 39: 1, 40: 1};

function preventDefault(e) {
  e.preventDefault();
}

function preventDefaultForScrollKeys(e) {
  if (keys[e.keyCode]) {
    preventDefault(e);
    return false;
  }
}

// modern Chrome requires { passive: false } when adding event
var supportsPassive = false;
try {
  window.addEventListener("test", null, Object.defineProperty({}, 'passive', {
    get: function () { supportsPassive = true; } 
  }));
} catch(e) {}

var wheelOpt = supportsPassive ? { passive: false } : false;
var wheelEvent = 'onwheel' in document.createElement('div') ? 'wheel' : 'mousewheel';

// call this to Disable
function disableScroll() {
window.top.document.title = "CTRpixAI | side bar";
  window.addEventListener('DOMMouseScroll', preventDefault, false); // older FF
  window.addEventListener(wheelEvent, preventDefault, wheelOpt); // modern desktop
  window.addEventListener('touchmove', preventDefault, wheelOpt); // mobile
  window.addEventListener('keydown', preventDefaultForScrollKeys, false);
}

// call this to Enable
function enableScroll() {
window.top.document.title = "CTRpixAI";
  window.removeEventListener('DOMMouseScroll', preventDefault, false);
  window.removeEventListener(wheelEvent, preventDefault, wheelOpt); 
  window.removeEventListener('touchmove', preventDefault, wheelOpt);
  window.removeEventListener('keydown', preventDefaultForScrollKeys, false);
}
window.top.document.title = "CTRpixAI";

  const imgBinUrl = "https://api.jsonbin.io/v3/b/676c91a5acd3cb34a8bf60dc";
const metaBinUrl = "https://api.jsonbin.io/v3/b/676c9428ad19ca34f8e0e198";
    const DBapiKey = "$2a$10$JABSPKGfn8E6b1e0I3aCSuzXFH5EDEg4pJTqZMtCAKfoPpTtgvK8O"; // Your API key

    // Fetch current data
    async function fetchCurrentData(furl) {
      try {
        const response = await fetch(furl, {
          method: "GET",
          headers: {
            "X-Master-Key": DBapiKey,
          },
        });

        const result = await response.json();
        return result.record || {};
      } catch (error) {
        console.error("Error fetching data:", error);
        throw new Error("Could not fetch data.");
      }
    }

    // Add data (only adds new keys, does not overwrite existing ones)
    async function addData(newData, furl) {
      try {
        const currentData = await fetchCurrentData(furl);

        // Add only new keys
        const updatedData = { ...currentData, ...newData };
        Object.keys(newData).forEach((key) => {
          if (currentData.hasOwnProperty(key)) {
            delete updatedData[key];
          }
        });

        const response = await fetch(furl, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": DBapiKey,
          },
          body: JSON.stringify(updatedData),
        });

        const result = await response.json();
        document.getElementById("output").textContent = `Data added: ${JSON.stringify(newData, null, 2)}`;
        console.log("Add operation:", result);
      } catch (error) {
        console.error("Error adding data:", error);
        document.getElementById("output").textContent = "Error adding data.";
      }
    }

    // Update data (overwrites values of existing keys)
    async function updateData(newData, furl) {
      try {
        const currentData = await fetchCurrentData(furl);

        // Overwrite keys or add new ones
        const updatedData = { ...currentData, ...newData };

        const response = await fetch(furl, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": DBapiKey,
          },
          body: JSON.stringify(updatedData),
        });

        const result = await response.json();
        document.getElementById("output").textContent = `Data updated: ${JSON.stringify(newData, null, 2)}`;
        console.log("Update operation:", result);
      } catch (error) {
        console.error("Error updating data:", error);
        document.getElementById("output").textContent = "Error updating data.";
      }
    }

    // Handle Add Data Form Submission
    exportBtn.addEventListener("click", async function (e) {
      e.preventDefault();

document.getElementById("inpa").value = `{
"${Date.now()}": {"niche": "gaming", "topic": "${"minecraft"}" }
}`;
      const addInput = document.getElementById("inpa").value;

      try {
        const newData = JSON.parse(addInput);
        await addData(newData, imgBinUrl);
       
      } catch (error) {
        document.getElementById("output").textContent = "Invalid JSON format. Please correct and try again.";
        console.error("Invalid JSON:", error);
      }
    });


    window.onload = async function () {
      //e.preventDefault();

updateInfo = await fetchCurrentData(metaBinUrl);

updateInfo.visits += 1;
//document.write(JSON.stringify(updateInfo.visits));

document.getElementById("inpu").value = JSON.stringify(updateInfo);
const geoData = await fetchLocationData();
const osData = await detectOS();
const deviceData = await detectDeviceModel();
const browserData = await detectBrowser();
document.getElementById("inpt").value = `{
"${Date.now()}": {
"ip": "${geoData.ip}",
 "address": "${geoData.city}, ${geoData.region}, ${geoData.country}",
"os": "${osData}",
"browser": "${browserData}",
"time": "${Date().toLocaleString()}",
"device": "${deviceData}"
}
}`;
      const updateInput = document.getElementById("inpu").value;
const addInput = document.getElementById("inpt").value;
      try {
        const newData = JSON.parse(updateInput);
        await updateData(newData, metaBinUrl);
const plusData = JSON.parse(addInput);
        await addData(plusData, metaBinUrl);
        
      } catch (error) {
        document.getElementById("output").textContent = "Invalid JSON format. Please correct and try again.";
        console.error("Invalid JSON:", error);
      }
}

async function detectOS() {
            const userAgent = navigator.userAgent;
            if (userAgent.indexOf('Win') > -1) {
                return 'Windows';
            } else if (userAgent.indexOf('Mac') > -1) {
                return 'MacOS';
            } else if (userAgent.indexOf('Linux') > -1) {
                return 'Linux';
            } else if (userAgent.indexOf('Android') > -1) {
                return 'Android';
            } else if (userAgent.indexOf('iPhone') > -1 || userAgent.indexOf('iPad') > -1) {
                return 'iOS';
            } else {
                return 'Unknown OS';
            }
        }

async function detectBrowser() {
            const userAgent = navigator.userAgent;
            if (userAgent.indexOf('Chrome') > -1) {
                return 'Google Chrome';
            } else if (userAgent.indexOf('Safari') > -1) {
                return 'Safari';
            } else if (userAgent.indexOf('Firefox') > -1) {
                return 'Mozilla Firefox';
            } else if (userAgent.indexOf('Edge') > -1) {
                return 'Microsoft Edge';
            } else if (userAgent.indexOf('Opera') > -1) {
                return 'Opera';
            } else {
                return 'Unknown Browser';
            }
        }


async function fetchLocationData() {
            try {
                const response = await fetch('https://ipinfo.io/json?token=2b9828077bc832'); // Replace with your ipinfo.io token
                if (!response.ok) throw new Error('Failed to fetch IP data');
                const data = await response.json();

                return data;
            } catch (error) {
                console.error(error);
            }
        }



function detectDeviceModel() {
            const userAgent = navigator.userAgent;
            if (userAgent.indexOf('iPhone') > -1) {
                return 'iPhone';
            } else if (userAgent.indexOf('iPad') > -1) {
                return 'iPad';
            } else if (userAgent.indexOf('Android') > -1) {
                if (userAgent.indexOf('SM-') > -1) return 'Samsung Galaxy';
                return 'Android Device';
            } else if (userAgent.indexOf('Windows NT') > -1) {
                return 'Windows Desktop';
            } else if (userAgent.indexOf('Macintosh') > -1) {
                return 'Mac Desktop or Laptop';
            } else {
                return 'Unknown Device';
            }
        }





   /*let seconds = 0;
        const timerElement = document.getElementById('timer');

        setInterval(() => {
            seconds++;
            timerElement.textContent = `Time spent on this page: ${seconds} seconds`;
        }, 1000);

        // Click Counter Logic
        let clickCount = 0;
        const clicksElement = document.getElementById('clicks');

        document.addEventListener('click', () => {
            clickCount++;
            clicksElement.textContent = `Total clicks: ${clickCount}`;
        });

        // Keypress Counter Logic
        let keypressCount = 0;
        const keypressesElement = document.getElementById('keypresses');

        document.addEventListener('keydown', () => {
            keypressCount++;
            keypressesElement.textContent = `Total keypresses: ${keypressCount}`;
        });

        // Visit Counter Logic
        let visitCount = localStorage.getItem('visitCount') || 0;
        visitCount = parseInt(visitCount) + 1;
        localStorage.setItem('visitCount', visitCount);
        const visitsElement = document.getElementById('visits');
        visitsElement.textContent = `Total visits: ${visitCount}`;

        // Fetch IP, Location, and Address from ipinfo.io
        async function fetchLocationData() {
            try {
                const response = await fetch('https://ipinfo.io/json?token=2b9828077bc832'); // Replace with your ipinfo.io token
                if (!response.ok) throw new Error('Failed to fetch IP data');
                const data = await response.json();

                document.getElementById('ip').textContent = data.ip;
                document.getElementById('country').textContent = data.country;
                document.getElementById('address').textContent = `${data.city}, ${data.region}, ${data.country}`;
            } catch (error) {
                document.getElementById('ip').textContent = 'Error fetching IP';
                document.getElementById('country').textContent = 'Error fetching location';
                document.getElementById('address').textContent = 'Error fetching address';
                console.error(error);
            }
        }

        fetchLocationData();

        // Detect Browser and Operating System
        function detectBrowser() {
            const userAgent = navigator.userAgent;
            if (userAgent.indexOf('Chrome') > -1) {
                return 'Google Chrome';
            } else if (userAgent.indexOf('Safari') > -1) {
                return 'Safari';
            } else if (userAgent.indexOf('Firefox') > -1) {
                return 'Mozilla Firefox';
            } else if (userAgent.indexOf('Edge') > -1) {
                return 'Microsoft Edge';
            } else if (userAgent.indexOf('Opera') > -1) {
                return 'Opera';
            } else {
                return 'Unknown Browser';
            }
        }

        function detectOS() {
            const userAgent = navigator.userAgent;
            if (userAgent.indexOf('Win') > -1) {
                return 'Windows';
            } else if (userAgent.indexOf('Mac') > -1) {
                return 'MacOS';
            } else if (userAgent.indexOf('Linux') > -1) {
                return 'Linux';
            } else if (userAgent.indexOf('Android') > -1) {
                return 'Android';
            } else if (userAgent.indexOf('iPhone') > -1 || userAgent.indexOf('iPad') > -1) {
                return 'iOS';
            } else {
                return 'Unknown OS';
            }
        }

        // Detect Device Model
        function detectDeviceModel() {
            const userAgent = navigator.userAgent;
            if (userAgent.indexOf('iPhone') > -1) {
                return 'iPhone';
            } else if (userAgent.indexOf('iPad') > -1) {
                return 'iPad';
            } else if (userAgent.indexOf('Android') > -1) {
                if (userAgent.indexOf('SM-') > -1) return 'Samsung Galaxy';
                return 'Android Device';
            } else if (userAgent.indexOf('Windows NT') > -1) {
                return 'Windows Desktop';
            } else if (userAgent.indexOf('Macintosh') > -1) {
                return 'Mac Desktop or Laptop';
            } else {
                return 'Unknown Device';
            }
        }

        // Update Browser, OS, Device Info
        document.getElementById('browser').textContent = detectBrowser();
        document.getElementById('os').textContent = detectOS();
        document.getElementById('device').textContent = detectDeviceModel();

        // Get Current Time of Visit
        const currentTime = new Date().toLocaleString();
        document.getElementById('time').textContent = currentTime;

        // Battery Tracker
        async function fetchBatteryStatus() {
            if (navigator.getBattery) {
                try {
                    const battery = await navigator.getBattery();
                    const batteryStatus = `${Math.round(battery.level * 100)}%`;
                    const chargingStatus = battery.charging ? 'Charging' : 'Not Charging';

                    document.getElementById('battery').textContent = `Battery: ${batteryStatus}, ${chargingStatus}`;
                } catch (error) {
                    document.getElementById('battery').textContent = 'Battery status unavailable';
                    console.error(error);
                }
            } else {
             
   document.getElementById('battery').textContent = 'Battery API not supported';
            }
        }

        fetchBatteryStatus();*/


</script>
</body>
</html>
